# JBrowse visualization

Workflow to visualize pggb graphs in jbrowse


* JBrowse: https://github.com/GMOD/jbrowse-components/

* JBrowse MAF plugin: https://github.com/cmdcolin/jbrowse-plugin-mafviewer

* WGA Tools: https://github.com/wjwei-handsome/wgatools

* MAFChunk: https://github.com/pangenome/mafchunk

* `cargo install maf2bed`

1. build graph with `pggb`, e.g.:
   `docker run -it -v .:/data ghcr.io/pangenome/pggb:latest pggb -i data/<SEQUENCES.fa> -M -o data/OUTPUTDIR -n 2 -t 15 -p 90 -s 5000`
   - `SEQUENCES.fa` contains the assemblies from which to build the
     graph; name them `ASSEMBLYNAME.CHROMOSOME`, e.g., `hg38.chr1`,
     `chm13.chr12`, etc.
2. `wgatools pafpseudo -f <FASTA_FILE> -g <TARGET> -o <OUTPUT.maf> <INPUT.paf>`
   - `FASTA_FILE` is the file with all the sequenced from which the
     pggb graph was built
   - `TARGET` is the name of the assembly to use as reference; can
     leave empty to create multiple .maf files as output
   - `OUTPUT.maf` is the resulting MAF file
   - `INPUT.paf` is the PAF file generated by pggb during graph
     construction
3. chunk the resulting MAF file using MAFchunk: `mafchunk <OUTPUT.maf> 100000 > <CHUNKED.maf>`
5. `cat <CHUNKED.maf> | maf2bed <TARGET> | bgzip > out.bed.gz`
6. `tabix -p bed out.bed.gz`

Next start JBrowse (desktop, but web will work too) using:
```
# starts webpack dev server
cd products/jbrowse-desktop
yarn start

# starts electron window
cd products/jbrowse-desktop
yarn electron
```

Install the MAF Plugin (Tools -> Plugin Store -> MAFViewer Plugin) if
you have not done yet.

Then, add a MAF track; provide as input `out.bed.gz` and
`out.bed.gz.tbi`, and the names of the assemblies in `FASTA_FILE`.

